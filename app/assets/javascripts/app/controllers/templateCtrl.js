// Generated by CoffeeScript 1.9.1
(function() {
  'use strict';
  app.controller('templateListCtrl', [
    '$scope', '$stateParams', 'TemplateService', 'templates', function($scope, $stateParams, TemplateService, templates) {
      var key, ref, template;
      $scope.templates = templates.data;
      ref = $scope.templates;
      for (key in ref) {
        template = ref[key];
        if (parseInt(template.id) === parseInt($stateParams.template_id)) {
          $scope.templates[key]['active'] = true;
        } else {
          $scope.templates[key]['active'] = false;
        }
      }
      $scope.formTemplateName = '';
      return $scope.formTemplateSubmit = function() {
        var $promise, formParams;
        formParams = {
          name: $scope.formTemplateName.trim()
        };
        if (!$scope.formTemplateName) {
          return;
        }
        $promise = TemplateService.create(formParams);
        return $promise.success(function(data, status) {
          $scope.templates.unshift(data);
          $scope.formTemplateName = null;
          return console.log('Template created');
        });
      };
    }
  ]);

  app.controller('templateDetailCtrl', [
    '$scope', '$stateParams', '$state', 'TemplateService', 'TemplateItemService', 'template', 'template_items', function($scope, $stateParams, $state, TemplateService, TemplateItemService, template, template_items) {
      $scope.template = template.data;
      $scope.template_items = template_items.data;
      $scope.templateUpdate = function(template_id, name) {
        var $promise;
        $promise = TemplateService.update(template_id, name);
        return $promise.success(function(data, status) {
          console.log('template successfully updated');
          return $state.transitionTo($state.current, $stateParams, {
            reload: true
          });
        });
      };
      $scope.templateDelete = function(template_id, index) {
        var $promise;
        $promise = TemplateService["delete"](template_id);
        return $promise.success(function(data, status) {
          console.log('Template successfully removed');
          return $state.transitionTo("templates", $stateParams, {
            reload: true
          });
        });
      };
      $scope.formTemplateItemDescription = '';
      $scope.formTemplateItemSubmit = function() {
        var $promise, formParams;
        formParams = {
          name: $scope.formTemplateItemDescription.trim(),
          template_id: $scope.template.id
        };
        if (!$scope.formTemplateItemDescription) {
          return;
        }
        $promise = TemplateItemService.save($stateParams.template_id, formParams);
        return $promise.success(function(data, status) {
          $scope.template_items.unshift(data);
          return $scope.formTemplateItemDescription = null;
        });
      };
      $scope.templateItemUpdate = function(templateItem_id, description) {
        var $promise;
        $promise = TemplateItemService.update(templateItem_id, description);
        return $promise.success(function(data, status) {
          return console.log('Template item successfully updated');
        });
      };
      return $scope.templateItemDelete = function(templateItem_id, index) {
        var $promise;
        $promise = TemplateItemService["delete"](templateItem_id);
        return $promise.success(function(data, status) {
          $scope.template_items.splice(index, 1);
          return console.log('Template item successfully removed');
        });
      };
    }
  ]);

}).call(this);
